<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArniComp CPU Emulator</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-assembly_x86.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üñ•Ô∏è ArniComp CPU Emulator</h1>
            <div class="header-controls">
                <button id="reset-btn" class="btn btn-reset">üîÑ Reset</button>
                <button id="compile-btn" class="btn btn-primary">üî® Compile</button>
                <div class="step-controls">
                    <button id="step-btn" class="btn btn-step">üë£ Step</button>
                    <select id="step-count" class="step-count-select">
                        <option value="1">1</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="20">20</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
                <button id="run-btn" class="btn btn-run">‚ñ∂Ô∏è Run</button>
                <button id="stop-btn" class="btn btn-stop" disabled>‚èπÔ∏è Stop</button>
                <div class="breakpoint-controls">
                    <button id="toggle-breakpoint-btn" class="btn btn-small">üî¥ Breakpoint</button>
                    <button id="clear-breakpoints-btn" class="btn btn-small">üóëÔ∏è Clear All</button>
                </div>
            </div>
        </header>

        <div class="main-layout">
            <!-- Left Panel: Code Editor with Tabs -->
            <div class="left-panel">
                <div class="panel editor-panel">
                    <div class="editor-header">
                        <div class="tabs-container">
                            <div class="tabs">
                                <!-- Tabs will be added dynamically -->
                            </div>
                            <div class="view-tabs">
                                <button class="view-tab active" data-view="editor">üìù Editor</button>
                                <button class="view-tab" data-view="disassembly">üîç Disassembly</button>
                                <button class="view-tab" data-view="devices">üß© Devices</button>
                            </div>
                            <button class="new-tab-btn" title="New File">+</button>
                        </div>
                        <div class="file-controls">
                            <button id="new-file-btn" class="btn btn-small">ÔøΩ New</button>
                            <button id="open-file-btn" class="btn btn-small">üìÇ Open</button>
                            <button id="save-file-btn" class="btn btn-small">üíæ Save</button>
                            <button id="save-as-btn" class="btn btn-small">üíæ Save As</button>
                            <button id="settings-btn" class="btn btn-small">‚öôÔ∏è Settings</button>
                        </div>
                    </div>
                    <div class="editor-content">
                        <div id="editor-view" class="view-content active">
                            <div id="editor" class="code-editor"></div>
                            <div class="editor-status">
                                <span id="compile-status">Ready</span>
                                <span id="cursor-position">Line: 1, Col: 1</span>
                                <span id="file-status"></span>
                            </div>
                        </div>
                        <div id="disassembly-view" class="view-content">
                            <div id="disassembly" class="disassembly-view"></div>
                        </div>
                        <div id="devices-view" class="view-content">
                            <div id="devices" class="devices-view">
                                <h3>Connected Devices</h3>
                                <div id="device-list"></div>
                                <div id="sevenseg-panel" class="device seven-seg">
                                    <h4>7-Segment (seg0)</h4>
                                    <div class="sevenseg-display" id="sevenseg-display"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="vertical-resizer"></div>

            <!-- Right Panel: CPU State & Memory -->
            <div class="right-panel">
                <!-- CPU Registers -->
                <div class="panel cpu-panel">
                    <div class="panel-header-controls">
                        <h3>üéõÔ∏è CPU Registers</h3>
                        <button id="refresh-cpu-btn" class="btn btn-small">üîÑ</button>
                    </div>
                    
                    <!-- Data Format Selector -->
                    <div class="format-selector">
                        <label>Format:</label>
                        <select id="data-format">
                            <option value="hex">Hex</option>
                            <option value="decimal">Dec</option>
                            <option value="binary">Bin</option>
                        </select>
                    </div>

                    <!-- Registers Grid -->
                    <div class="registers-grid-improved">
                        <div class="register-column">
                            <div class="register-group">
                                <h4>General Purpose</h4>
                                <div class="register">
                                    <span class="reg-name">RA:</span>
                                    <span id="reg-ra" class="reg-value">0x00</span>
                                </div>
                                <div class="register">
                                    <span class="reg-name">RD:</span>
                                    <span id="reg-rd" class="reg-value">0x00</span>
                                </div>
                                <div class="register">
                                    <span class="reg-name">RB:</span>
                                    <span id="reg-rb" class="reg-value">0x00</span>
                                </div>
                                <div class="register">
                                    <span class="reg-name">ACC:</span>
                                    <span id="reg-acc" class="reg-value">0x00</span>
                                </div>
                            </div>

                            <div class="register-group">
                                <h4>Program Counter</h4>
                                <div class="register">
                                    <span class="reg-name">PC:</span>
                                    <span id="reg-pc" class="reg-value">0x0000</span>
                                </div>
                                <div class="register">
                                    <span class="reg-name">PRL:</span>
                                    <span id="reg-prl" class="reg-value">0x00</span>
                                </div>
                                <div class="register">
                                    <span class="reg-name">PRH:</span>
                                    <span id="reg-prh" class="reg-value">0x00</span>
                                </div>
                            </div>
                        </div>

                        <div class="register-column">
                            <div class="register-group">
                                <h4>Memory Address</h4>
                                <div class="register">
                                    <span class="reg-name">MARL:</span>
                                    <span id="reg-marl" class="reg-value">0x00</span>
                                </div>
                                <div class="register">
                                    <span class="reg-name">MARH:</span>
                                    <span id="reg-marh" class="reg-value">0x00</span>
                                </div>
                                <div class="register">
                                    <span class="reg-name">ADDR:</span>
                                    <span id="data-addr" class="reg-value">0x0000</span>
                                </div>
                            </div>

                            <div class="register-group">
                                <h4>Status & I/O</h4>
                                <div class="flags-compact">
                                    <span class="flag" id="flag-eq">EQ: 0</span>
                                    <span class="flag" id="flag-lt">LT: 0</span>
                                    <span class="flag" id="flag-gt">GT: 0</span>
                                    <span class="flag" id="flag-carry">C: 0</span>
                                </div>
                                <div class="io-compact">
                                    <span>Out: <span id="output-data">0x00</span>@<span id="output-addr">0x00</span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Memory Viewers -->
                <div class="memory-panels">
                    <div class="panel memory-panel">
                        <h3>üíæ Data Memory</h3>
                        <div class="memory-controls">
                            <input type="number" id="data-memory-start" value="0" min="0" max="65535" placeholder="Start Address">
                            <input type="number" id="data-memory-end" value="31" min="0" max="65535" placeholder="End Address">
                            <button id="refresh-data-memory" class="btn btn-small">üîÑ</button>
                        </div>
                        <div id="data-memory" class="memory-view"></div>
                    </div>

                    <div class="panel memory-panel">
                        <h3>üìú Program Memory</h3>
                        <div class="memory-controls">
                            <input type="number" id="program-memory-start" value="0" min="0" max="65535" placeholder="Start Address">
                            <input type="number" id="program-memory-end" value="31" min="0" max="65535" placeholder="End Address">
                            <button id="refresh-program-memory" class="btn btn-small">üîÑ</button>
                        </div>
                        <div id="program-memory" class="memory-view"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <footer class="status-bar">
            <span id="emulator-status">Ready</span>
            <span id="execution-info">Not running</span>
        </footer>
    </div>

    <!-- File Open Modal -->
    <div id="file-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìÇ Open File</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="file-source-tabs">
                    <button class="file-source-tab active" data-source="local">üíª From Computer</button>
                    <button class="file-source-tab" data-source="examples">üìö Example Files</button>
                </div>
                
                <div id="local-files" class="file-source-content active">
                    <div class="file-upload-area">
                        <input type="file" id="file-input" accept=".asm,.txt,.bin" style="display: none;">
                        <button id="browse-file-btn" class="btn btn-primary">üìÅ Browse Files</button>
                        <p class="file-hint">Select an assembly (.asm), text (.txt), or binary (.bin) file</p>
                        <div id="selected-file-info" class="selected-file-info" style="display: none;">
                            <span id="selected-file-name"></span>
                            <button id="clear-selection-btn" class="btn btn-small">‚úï</button>
                        </div>
                    </div>
                </div>
                
                <div id="examples-files" class="file-source-content">
                    <div class="file-list" id="file-list">
                        <div class="loading">Loading example files...</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="modal-cancel" class="btn btn-secondary">Cancel</button>
                <button id="modal-open" class="btn btn-primary" disabled>Open</button>
            </div>
        </div>
    </div>

    <!-- Save As Modal -->
    <div id="save-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üíæ Save As</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <label for="save-filename">Filename:</label>
                <input type="text" id="save-filename" placeholder="example.asm" class="filename-input">
                <div class="filename-hint">Files will be saved with .asm extension</div>
            </div>
            <div class="modal-footer">
                <button id="save-modal-cancel" class="btn btn-secondary">Cancel</button>
                <button id="save-modal-save" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Settings</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3>Data Memory Display</h3>
                    <div class="setting-group">
                        <label for="data-memory-start-hex">Start Address (hex):</label>
                        <input type="text" id="data-memory-start-hex" placeholder="0000" pattern="[0-9A-Fa-f]*">
                    </div>
                    <div class="setting-group">
                        <label for="data-memory-end-hex">End Address (hex):</label>
                        <input type="text" id="data-memory-end-hex" placeholder="00FF" pattern="[0-9A-Fa-f]*">
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>Program Memory Display</h3>
                    <div class="setting-group">
                        <label for="program-memory-start-hex">Start Address (hex):</label>
                        <input type="text" id="program-memory-start-hex" placeholder="0000" pattern="[0-9A-Fa-f]*">
                    </div>
                    <div class="setting-group">
                        <label for="program-memory-end-hex">End Address (hex):</label>
                        <input type="text" id="program-memory-end-hex" placeholder="00FF" pattern="[0-9A-Fa-f]*">
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>Disassembly Display</h3>
                    <div class="setting-group">
                        <label for="disassembly-count">Instructions to show:</label>
                        <input type="number" id="disassembly-count" min="16" max="1024" step="16" placeholder="32">
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>Performance</h3>
                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="auto-refresh" checked> 
                            Auto-refresh during execution
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="reset-settings" class="btn btn-secondary">Reset</button>
                <button id="settings-cancel" class="btn btn-secondary">Cancel</button>
                <button id="apply-settings" class="btn btn-primary">Apply</button>
            </div>
        </div>
    </div>

    <!-- ACE Editor -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.0/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.0/mode-assembly_x86.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.0/theme-monokai.js"></script>
    
    <!-- Emulator Logic -->
    <script src="{{ url_for('static', path='js/emulator.js') }}"></script>
</body>
</html>
